
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Instrumental Noise in Kepler and K2 #1: Data Gaps and Quality Flags &#8212; MAST Notebook Repository</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Instrumental Noise in Kepler and K2 #2: Spurious Signals and Time Sampling Effects" href="../kepler_instrumental_noise_2_spurious_signals_and_time_sampling_effects/kepler_instrumental_noise_2_spurious_signals_and_time_sampling_effects.html" />
    <link rel="prev" title="Identifying Transiting Planet Signals in a Kepler Light Curve" href="../kepler_identifying_transiting_planet_signals/kepler_identifying_transiting_planet_signals.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../../../_static/mastlogo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">MAST Notebook Repository</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Astroquery
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../astroquery/beginner_search_astroquery/beginner_search_astroquery.html">
   Beginner: Searching MAST using astroquery.mast
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../astroquery/large_downloads/large_downloads.html">
   Large Downloads in
   <code class="docutils literal notranslate">
    <span class="pre">
     astroquery.mast
    </span>
   </code>
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  HSC
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HCV_API/HCV_API_demo.html">
   Hubble Catalog of Variables Notebook (API version)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HCV_CASJOBS/HCV_casjobs_demo.html">
   Hubble Catalog of Variables Notebook (CasJobs version)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HSCV3_API/hscv3_api.html">
   Hubble Source Catalog API Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HSCV3_SMC_API/hscv3_smc_api.html">
   Hubble Source Catalog API Notebook: SMC Color-Magnitude Diagram
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/HSC_TAP/HSC_TAP.html">
   MAST Table Access Protocol Hubble Source Catalog Demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/SWEEPS_HSCV3P1/sweeps_hscv3p1.html">
   Hubble Source Catalog SWEEPS Proper Motion Notebook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../HSC/SWEEPS_HSCV3P1_API/sweeps_hscv3p1_api.html">
   Hubble Source Catalog SWEEPS Proper Motion Notebook
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  JWST
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../JWST/download_by_program_id/download_by_program_id.html">
   Accessing JWST Proposal Data in astroquery.mast
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../JWST/Engineering_Database_Retreival/EDB_Retrieval.html">
   JWST Engineering Data Retrieval
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Kepler K2
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../K2/K2_Lightcurve/K2_Lightcurve.html">
   Beginner: Read and Plot A K2 Light Curve File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../K2/K2_TPF/K2_TPF.html">
   Beginner: Read and Display A K2 Target Pixel File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../K2/beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">
   Beginner: Read and Display a K2 Full Frame Image
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../K2/k2_removing_instrumental_noise_using_pld/k2_removing_instrumental_noise_using_pld.html">
   Removing Instrumental Noise from
   <em>
    K2
   </em>
   and
   <em>
    TESS
   </em>
   Light Curves Using Pixel Level Decorrelation (PLD)
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Kepler
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Kepler_DVT/Kepler_DVT.html">
   Read and Plot A Kepler Data Validation Timeseries File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Kepler_FFI/kepler_ffi.html">
   Plotting a Catalog over a Kepler Full Frame Image File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Kepler_Lightcurve/kepler_lightcurve.html">
   Using Kepler Data to Plot a Light Curve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Kepler_TPF/kepler_tpf.html">
   Plotting Images from Kepler Target Pixel Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_combining_multiple_quarters/kepler_combining_multiple_quarters.html">
   Combining Multiple Quarters of
   <em>
    Kepler
   </em>
   Data with Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_creating_periodograms/kepler_creating_periodograms.html">
   Creating Periodograms and Identifying Significant Peaks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_creating_your_own_light_curves/kepler_creating_your_own_light_curves.html">
   Creating Your Own Light Curves using Custom Aperture Photometry
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_how_to_estimate_a_stars_mass_and_radius_using_asteroseismology/kepler_how_to_estimate_a_stars_mass_and_radius_using_asteroseismology.html">
   How to Estimate a Star’s Mass and Radius Using Asteroseismology
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star/kepler_how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star.html">
   How to Understand and Manipulate the Periodogram of an Oscillating Star
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_identifying_transiting_planet_signals/kepler_identifying_transiting_planet_signals.html">
   Identifying Transiting Planet Signals in a
   <em>
    Kepler
   </em>
   Light Curve
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #1: Data Gaps and Quality Flags
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_instrumental_noise_2_spurious_signals_and_time_sampling_effects/kepler_instrumental_noise_2_spurious_signals_and_time_sampling_effects.html">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #2: Spurious Signals and Time Sampling Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_instrumental_noise_3_seasonal_and_detector_effects/kepler_instrumental_noise_3_seasonal_and_detector_effects.html">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #3: Seasonal and Detector Effects
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_instrumental_noise_4_electronic_noise/kepler_instrumental_noise_4_electronic_noise.html">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #4: Electronic Noise
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_interactively_inspecting_target_pixel_files_and_light_curves/kepler_interactively_inspecting_target_pixel_files_and_light_curves.html">
   Interactively Inspecting Target Pixel Files and Light Curves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_measuring_a_rotation_period/kepler_measuring_a_rotation_period.html">
   Measuring and Removing a Rotation Period Signal from a
   <em>
    Kepler
   </em>
   Light Curve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_plotting_target_pixel_files/kepler_plotting_target_pixel_files.html">
   Plotting
   <em>
    Kepler
   </em>
   Target Pixel File Products with Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_searching_for_data_products/kepler_searching_for_data_products.html">
   Searching for
   <em>
    Kepler
   </em>
   /
   <em>
    K2
   </em>
   and
   <em>
    TESS
   </em>
   Data Products Using Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_using_light_curve_products_with_lightkurve/kepler_using_light_curve_products_with_lightkurve.html">
   Using
   <em>
    Kepler
   </em>
   Light Curve Products with Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_using_target_pixel_file_products_with_lightkurve/kepler_using_target_pixel_file_products_with_lightkurve.html">
   Using
   <em>
    Kepler
   </em>
   Target Pixel File Products with Lightkurve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_verifying_the_location_of_a_signal/kepler_verifying_the_location_of_a_signal.html">
   Verifying the Location of a Signal in
   <em>
    Kepler
   </em>
   Pixel Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../kepler_visualizing_periodic_signals_using_a_river_plot/kepler_visualizing_periodic_signals_using_a_river_plot.html">
   Visualizing Periodic Signals Using a River Plot
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  PanSTARRS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../PanSTARRS/PS1_DR2_TAP/PS1_DR2_TAP.html">
   MAST Table Access Protocol PanSTARRS 1 DR2 Demo
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  TESS
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_astroquery_dv/beginner_astroquery_dv.html">
   Beginner: Retrieve TESS Data Validation Products with Astroquery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_how_to_use_dvt/beginner_how_to_use_dvt.html">
   Beginner: Read and Plot A TESS Data Validation Timeseries File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">
   Beginner: Read and Display a TESS Full Frame Image
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_how_to_use_lc/beginner_how_to_use_lc.html">
   Beginner: Read and Plot A TESS Light Curve File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_how_to_use_tp/beginner_how_to_use_tp.html">
   Beginner: Read and Display A TESS Target Pixel File
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_tess_exomast/beginner_tess_exomast.html">
   Exoplanet Data and TESS Light Curves Using Python Requests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_tess_tap_search/beginner_tess_tap_search.html">
   Download MAST TESS Light Curves Within an FFI Footprint Using TAP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_tic_search_hd209458/beginner_tic_search_hd209458.html">
   Beginner: Search The TESS Input Catalog Centered On HD 209458.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/beginner_tour_lc_tp/beginner_tour_lc_tp.html">
   Beginnner: A Tour of the Contents of the TESS 2-minute Cadence Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/interm_gi_query/interm_gi_query.html">
   Intermediate:  Search and Download GI Program Light Curves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/interm_tasc_lc/interm_tasc_lc.html">
   Intermediate: Finding Flares and Variable Stars in TASC Light Curves
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/interm_tess_prf_retrieve/interm_tess_prf_retrieve.html">
   Intermediate: Retrieve TESS Pixel Response Function Images
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/interm_tesscut_astroquery/interm_tesscut_astroquery.html">
   Beginner: Cutout of the TESS FFIs using Astrocut and Astroquery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/interm_tesscut_dss_overlay/interm_tesscut_dss_overlay.html">
   Intermediate: Overlay a Cutout of the TESS FFIs with DSS imaging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/interm_tesscut_requests/interm_tesscut_requests.html">
   Intermediate: Create TESS FFI Cutout using Python Requests
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../TESS/tess_removing_scattered_light_using_regression/tess_removing_scattered_light_using_regression.html">
   Removing Scattered Light from
   <em>
    TESS
   </em>
   Data Using the Lightkurve
   <code class="docutils literal notranslate">
    <span class="pre">
     RegressionCorrector
    </span>
   </code>
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/TheRealZoidberg/mast/"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/TheRealZoidberg/mast//issues/new?title=Issue%20on%20page%20%2Fnotebooks/MAST/Kepler/kepler_instrumental_noise_1_data_gaps_and_quality_flags/kepler_instrumental_noise_1_data_gaps_and_quality_flags.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../../_sources/notebooks/MAST/Kepler/kepler_instrumental_noise_1_data_gaps_and_quality_flags/kepler_instrumental_noise_1_data_gaps_and_quality_flags.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #1: Data Gaps and Quality Flags
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-goals">
     Learning Goals
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background">
     1. Background
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quality-flags">
       1.1 Quality flags
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-data-gaps">
     2. Common Data Gaps
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#monthly-data-downlink">
       2.1 Monthly data downlink
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#safe-modes">
       2.2 Safe modes
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#coarse-pointing-and-loss-of-fine-pointing">
       2.3 Coarse pointing and loss of fine pointing
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#single-cadence-events">
     3. Single-Cadence Events
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cosmic-rays">
       3.1 Cosmic rays
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#argabrightening">
       3.2 Argabrightening
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#attitude-tweaks">
       3.3 Attitude tweaks
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reaction-wheel-events">
       3.4 Reaction wheel events
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#manual-exclusions">
       3.5 Manual exclusions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k2">
     4.
     <em>
      K2
     </em>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     About this Notebook
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#citing-lightkurve-and-astropy">
   Citing Lightkurve and Astropy
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Instrumental Noise in Kepler and K2 #1: Data Gaps and Quality Flags</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Instrumental Noise in
   <em>
    Kepler
   </em>
   and
   <em>
    K2
   </em>
   #1: Data Gaps and Quality Flags
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#learning-goals">
     Learning Goals
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introduction">
     Introduction
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imports">
     Imports
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background">
     1. Background
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#quality-flags">
       1.1 Quality flags
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#common-data-gaps">
     2. Common Data Gaps
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#monthly-data-downlink">
       2.1 Monthly data downlink
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#safe-modes">
       2.2 Safe modes
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#coarse-pointing-and-loss-of-fine-pointing">
       2.3 Coarse pointing and loss of fine pointing
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#single-cadence-events">
     3. Single-Cadence Events
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cosmic-rays">
       3.1 Cosmic rays
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#argabrightening">
       3.2 Argabrightening
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#attitude-tweaks">
       3.3 Attitude tweaks
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#reaction-wheel-events">
       3.4 Reaction wheel events
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#manual-exclusions">
       3.5 Manual exclusions
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#k2">
     4.
     <em>
      K2
     </em>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#about-this-notebook">
     About this Notebook
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#citing-lightkurve-and-astropy">
   Citing Lightkurve and Astropy
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="instrumental-noise-in-kepler-and-k2-1-data-gaps-and-quality-flags">
<h1>Instrumental Noise in <em>Kepler</em> and <em>K2</em> #1: Data Gaps and Quality Flags<a class="headerlink" href="#instrumental-noise-in-kepler-and-k2-1-data-gaps-and-quality-flags" title="Permalink to this headline">#</a></h1>
<hr class="docutils" />
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this headline">#</a></h2>
<p>By the end of this tutorial, you will:</p>
<ul class="simple">
<li><p>Have a working knowledge of <em>Kepler</em> quality flags and be able to access them in light curve and TPF data.</p></li>
<li><p>Be able to identify the cause of various types of gaps in the data.</p></li>
<li><p>Understand the most common reasons for individual cadence exclusions.</p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>This notebook is the first part of a series on identifying instrumental and systematic sources of noise in <em>Kepler</em> and <em>K2</em> data. In this tutorial, we will look at practical examples of data gaps and single-cadence quality issues in <em>Kepler</em> data, and learn to identify their causes. Assumed knowledge for this tutorial is a good familiarity with light curve and target pixel file (TPF) data products, and the ability to work with their metadata.</p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">#</a></h2>
<p>We’ll use <strong><a class="reference external" href="https://docs.lightkurve.org/">Lightkurve</a></strong> for downloading and handling <em>Kepler</em> data throughout this tutorial. We’ll also use <strong><a class="reference external" href="https://numpy.org/">NumPy</a></strong> to perform a few auxiliary functions, and <strong><a class="reference external" href="https://matplotlib.org/">Matplotlib</a></strong> for plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="background">
<h2>1. Background<a class="headerlink" href="#background" title="Permalink to this headline">#</a></h2>
<p>The <em>Kepler</em> space telescope observed the same patch of sky for four continuous years, between 2009 and 2013. Over the course of 18 observing quarters, it collected light curves and pixel data for 150,000 stars in 30-minute Long Cadence mode, and 512 stars per quarter in one-minute Short Cadence mode. Following the failure of two of the telescope’s four reaction wheels, the telescope continued as the <em>K2</em> mission, which observed along the ecliptic plane for 20 campaigns.</p>
<p>In this tutorial, we’ll explore some quality issues that arose during both the <em>Kepler</em> and <em>K2</em> missions, and learn how to identify and mitigate them. It’s important to note that many of these issues only appear in the calibrated pixels or simple aperture photometry (SAP) data, and more still are removed by a quality masking process which we’ll discuss in the next section. If you’re working with presearch data conditioning SAP (PDCSAP) light curves, you won’t run into many of these issues.</p>
<section id="quality-flags">
<h3>1.1 Quality flags<a class="headerlink" href="#quality-flags" title="Permalink to this headline">#</a></h3>
<p>Before we look at some practical examples in time series data, let’s familiarize ourselves with how data gaps and single-cadence quality events are identified in <em>Kepler</em> data files. Every <em>Kepler</em> FITS file has a <code class="docutils literal notranslate"><span class="pre">QUALITY</span></code> column, which contains a quality flag for each individual data cadence. These flags comprise of one or more binary bits, which are expressed as an integer. A handy reference document for <em>Kepler</em>’s quality flags is Table 2-3 in the <a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/k2/_documents/MAST_Kepler_Archive_Manual_2020.pdf">MAST Kepler Archive Manual</a>.</p>
<p>Let’s start by downloading the data we’ll work with throughout this tutorial:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_lightcurve</span><span class="p">(</span><span class="s1">&#39;KIC 2436365&#39;</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="s1">&#39;kepler&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s1">&#39;kepler&#39;</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>By default, Lightkurve downloads quality-masked data. This means that a variety of cadences with a non-zero quality flag will already be removed from the light curves or TPFs you download using the instruction above.</p>
<p>For this tutorial, we are also going to download some TPF data with no quality mask applied.  We can do this by passing the optional <code class="docutils literal notranslate"><span class="pre">quality_bitmask=0</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">download()</span></code> method as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_targetpixelfile</span><span class="p">(</span><span class="s1">&#39;KIC 2436365&#39;</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">quality_bitmask</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Passing <code class="docutils literal notranslate"><span class="pre">quality_bitmask=0</span></code> has the effect of including every cadence in the data, even those with serious quality issues or NaN (<a class="reference external" href="https://en.wikipedia.org/wiki/NaN">not a number</a>) values in the flux. This is not necessarily recommended when using Lightkurve, but here it will allow us to explore a wide variety of data quality issues, many of which will be useful to know about if you’re working directly with FITS files from MAST.</p>
<p>Now that we have our data, let’s have a look at the range of quality flags present. Remember, this is the unmasked data, so every flagged cadence is included.</p>
<p>Here, we’re using the NumPy function <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.unique.html"><code class="docutils literal notranslate"><span class="pre">unique()</span></code></a>, which takes an array as its input and returns every unique value:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">quality</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([     0,      1,     16,     64,    128,    144,    256,   4160,
         8192,   8208,   8320,  12352,  16384,  32772,  32778,  32800,
        32804,  32816,  98305,  98312,  98314, 393216, 393232, 393344,
       401408, 409600], dtype=int32)
</pre></div>
</div>
</div>
</div>
<p>You’ll notice that some of these appear to be integers that correspond to bits — that is, powers of two — but others are additive. This indicates that multiple quality issues are present in a particular cadence.</p>
<p>We can use Lightkurve’s <a class="reference external" href="https://docs.lightkurve.org/api/lightkurve.utils.KeplerQualityFlags.html#lightkurve.utils.KeplerQualityFlags.decode"><code class="docutils literal notranslate"><span class="pre">decode()</span></code></a> function for accessing the information stored in each quality flag:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">quality</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">lk</span><span class="o">.</span><span class="n">KeplerQualityFlags</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">flag</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0 []
1 [&#39;Attitude tweak&#39;]
16 [&#39;Zero crossing&#39;]
64 [&#39;Argabrightening&#39;]
128 [&#39;Cosmic ray in optimal aperture&#39;]
144 [&#39;Zero crossing&#39;, &#39;Cosmic ray in optimal aperture&#39;]
256 [&#39;Manual exclude&#39;]
4160 [&#39;Argabrightening&#39;, &#39;Argabrightening on CCD&#39;]
8192 [&#39;Cosmic ray in collateral data&#39;]
8208 [&#39;Zero crossing&#39;, &#39;Cosmic ray in collateral data&#39;]
8320 [&#39;Cosmic ray in optimal aperture&#39;, &#39;Cosmic ray in collateral data&#39;]
12352 [&#39;Argabrightening&#39;, &#39;Argabrightening on CCD&#39;, &#39;Cosmic ray in collateral data&#39;]
16384 [&#39;Detector anomaly&#39;]
32772 [&#39;Coarse point&#39;, &#39;No fine point&#39;]
32778 [&#39;Safe mode&#39;, &#39;Earth point&#39;, &#39;No fine point&#39;]
32800 [&#39;Desaturation event&#39;, &#39;No fine point&#39;]
32804 [&#39;Coarse point&#39;, &#39;Desaturation event&#39;, &#39;No fine point&#39;]
32816 [&#39;Zero crossing&#39;, &#39;Desaturation event&#39;, &#39;No fine point&#39;]
98305 [&#39;Attitude tweak&#39;, &#39;No fine point&#39;, &#39;No data&#39;]
98312 [&#39;Earth point&#39;, &#39;No fine point&#39;, &#39;No data&#39;]
98314 [&#39;Safe mode&#39;, &#39;Earth point&#39;, &#39;No fine point&#39;, &#39;No data&#39;]
393216 [&#39;Rolling band in optimal aperture&#39;, &#39;Rolling band in full mask&#39;]
393232 [&#39;Zero crossing&#39;, &#39;Rolling band in optimal aperture&#39;, &#39;Rolling band in full mask&#39;]
393344 [&#39;Cosmic ray in optimal aperture&#39;, &#39;Rolling band in optimal aperture&#39;, &#39;Rolling band in full mask&#39;]
401408 [&#39;Cosmic ray in collateral data&#39;, &#39;Rolling band in optimal aperture&#39;, &#39;Rolling band in full mask&#39;]
409600 [&#39;Detector anomaly&#39;, &#39;Rolling band in optimal aperture&#39;, &#39;Rolling band in full mask&#39;]
</pre></div>
</div>
</div>
</div>
<p>We can use Python’s “bitwise and” operator (&amp;) to select the cadence numbers affected by a specific quality flag as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span><span class="o">.</span><span class="n">cadenceno</span><span class="p">[(</span><span class="n">tpf</span><span class="o">.</span><span class="n">quality</span> <span class="o">&amp;</span> <span class="mi">64</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># cadence numbers flagged for &quot;Argabrightening&quot; (flag 64)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([4060, 5767, 6432, 6796, 6797], dtype=int32)
</pre></div>
</div>
</div>
</div>
<p>In the following sections, we’ll walk through the majority of these data quality events, and look at practical examples in the light curve and TPF we downloaded above.</p>
<p>Some of these flags are not covered in this tutorial, such as rolling bands. For more information on other data quality issues, see other tutorials in this series, as well as the various <a class="reference external" href="https://archive.stsci.edu/missions-and-data/kepler/documents"><em>Kepler</em> Data Handbooks</a>.</p>
</section>
</section>
<section id="common-data-gaps">
<h2>2. Common Data Gaps<a class="headerlink" href="#common-data-gaps" title="Permalink to this headline">#</a></h2>
<p>The nominal <em>Kepler</em> mission observed one area continuously between 2009 and 2013 — but of course, there were various necessary breaks in that continuity. For example, the telescope rotated at the end of each quarter, which necessitated a break in data collection.</p>
<p>We can use quality flags to identify these various events, but often it’s more convenient to check the <em>Kepler</em> Mission Timeline, from the <a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/Data_Characteristics.pdf"><em>Kepler</em> Data Characteristics Handbook</a>:</p>
<p><img alt="Kepler Mission Timeline from the Data Characteristics Handbook, a calendar showing Quarters 0–17 from 2009–13, with major events and data gaps marked." src="../../../../_images/kepler-mission-timeline.png" /></p>
<p>Throughout this section we’ll explore the most common reasons for gaps in <em>Kepler</em> data: monthly data downlinks, safe modes, and coarse pointing/loss of fine pointing. Though we’re looking at <em>Kepler</em> data here, these data gaps can also be found in <em>K2</em> mission data.</p>
<section id="monthly-data-downlink">
<h3>2.1 Monthly data downlink<a class="headerlink" href="#monthly-data-downlink" title="Permalink to this headline">#</a></h3>
<p>During the <em>Kepler</em> mission, the telescope changed its orientation once a month to point at Earth and downlink the last month of data. This caused a gap in the time series data, as the telescope could not collect while it was downlinking. When the telescope returned to regular pointing, its motion induced what is known as a “thermal transient.” This means that the telescope components and detector electronics underwent a temperature change, and the electron count reading was temporarily increased. A change in temperature can slightly change the telescope focus. This manifests in the simple aperture photometry (SAP) data as a downward slope caused by “reheating,” while the flux returns to its previous level. The thermal transient is corrected in PDCSAP data; there is no quality flag for data affected by a thermal transient. (<a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/Data_Characteristics.pdf"><em>Kepler</em> Data Characteristics Handbook</a>, Section 5.5.)</p>
<p>The following code uses Matplotlib to zoom in on an Earth pointing event and highlight the affected section of the SAP light curve:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;sap_flux&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">225</span><span class="p">,</span> <span class="mi">238</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">5300</span><span class="p">,</span> <span class="mi">5600</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mf">230.3</span><span class="p">,</span> <span class="mf">231.4</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_20_0.png" src="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_20_0.png" />
</div>
</div>
</section>
<section id="safe-modes">
<h3>2.2 Safe modes<a class="headerlink" href="#safe-modes" title="Permalink to this headline">#</a></h3>
<p>Safe modes (<a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/Data_Characteristics.pdf"><em>Kepler</em> Data Characteristics Handbook</a>, Section 4.2) are another type of thermal transient that appears in <em>Kepler</em> data. A safe mode occured when the telescope temporarily shut off operation due to an unexpected event, usually caused by an issue with the detector electronics.</p>
<p>There were eleven safe mode events throughout the <em>Kepler</em> mission, and three during <em>K2</em>, in Campaigns 0, 9, and 12. The following code zooms in on the Quarter 2 safe mode, in the same data we’ve used above; note the similarity in appearance between the two thermal transient events.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;sap_flux&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">170</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">5450</span><span class="p">,</span> <span class="mi">5800</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mf">181.5</span><span class="p">,</span> <span class="mf">183.8</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_22_0.png" src="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_22_0.png" />
</div>
</div>
</section>
<section id="coarse-pointing-and-loss-of-fine-pointing">
<h3>2.3 Coarse pointing and loss of fine pointing<a class="headerlink" href="#coarse-pointing-and-loss-of-fine-pointing" title="Permalink to this headline">#</a></h3>
<p>Running the code below, you’ll see two highlighted regions where there is no thermal transient, but still a gap in the data. Often, gaps like this are caused by a loss of fine pointing (<a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/Data_Characteristics.pdf"><em>Kepler</em> Data Characteristics Handbook</a>, Section 4.3). Because there is lower photometric precision when this occurs, these cadences are not suggested for use in photometry, and are replaced with NaNs.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">QUALITY</span></code> column, there are two flags for this situation: a 4 (bit 3) for coarse point, and 32768 (bit 16) for a loss of fine point. Coarse point is a manual flag, based on preprocessing, and coarse point cadences are removed based on an expected loss of fine pointing. Cadences marked as “no fine point” are due to unexpected events; in practice, these two quality issues manifest in the same manner as gapped data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;sap_flux&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">215</span><span class="p">,</span><span class="mi">260</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="mi">5550</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mf">223.5</span><span class="p">,</span> <span class="mi">224</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mf">255.3</span><span class="p">,</span> <span class="mf">256.4</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_24_0.png" src="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_24_0.png" />
</div>
</div>
<p>Let’s also look at a TPF cadence affected by a loss of fine pointing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">((</span><span class="n">tpf</span><span class="o">.</span><span class="n">quality</span> <span class="o">&amp;</span> <span class="mi">32804</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)][</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cadenceno</span><span class="o">=</span><span class="n">tpf</span><span class="o">.</span><span class="n">cadenceno</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">quality</span> <span class="o">==</span> <span class="mi">32804</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[[nan nan nan nan nan]
  [nan nan nan nan nan]
  [nan nan nan nan nan]
  [nan nan nan nan nan]]] electron / s
</pre></div>
</div>
<img alt="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_26_1.png" src="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_26_1.png" />
</div>
</div>
<p>As you can see, there’s no data available for this cadence at the TPF level. The vast majority of data affected by a loss of fine pointing/coarse pointing during the <em>Kepler</em> and <em>K2</em> missions is “gapped” like this. When performing photometry or light curve corrections, it’s important to pay attention to the data on either side of these gaps and make sure you don’t overcorrect it.</p>
</section>
</section>
<section id="single-cadence-events">
<h2>3. Single-Cadence Events<a class="headerlink" href="#single-cadence-events" title="Permalink to this headline">#</a></h2>
<p>We’ve now seen some situations in <em>Kepler</em> data where you’ll observe a gap in the data — or NaN flux — and what the time series looks like on either side of those events. But there are many quality issues which can have an impact on one or more cadences at a time, which aren’t necessarily as evident as data gaps. In the following sections, we’ll look at some of the causes behind these single-cadence quality issues, where you’ll find them, and how to mitigate them in a practical context.</p>
<section id="cosmic-rays">
<h3>3.1 Cosmic rays<a class="headerlink" href="#cosmic-rays" title="Permalink to this headline">#</a></h3>
<p>Cosmic rays on the detector (<a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/KSCI-19033-002-instrument-hb.pdf"><em>Kepler</em> Instrument Handbook</a>, Section 4.16) are an unavoidable source of quality issues in all space based data. Depending on the severity of the event, an incidence of a cosmic ray can lead to sudden pixel sensitivity dropouts (SPSD) — covered in another tutorial in this series — or even long-term damage. Here, we’ll only look at the short-term events.</p>
<p>The cell below plots a section of our light curve for KIC 2436365 from above, showing a spike caused by a cosmic ray hitting the detector. Note that this is PDCSAP flux: most cosmic rays are removed by  presearch data conditioning (PDC), but those that aren’t can be caught by outlier clipping or, in this case, may not be a large enough spike to cause problems.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">243</span><span class="p">,</span> <span class="mi">257</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymax</span><span class="o">=</span><span class="mi">6540</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mi">250</span><span class="p">,</span> <span class="mf">250.8</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.collections.PolyCollection at 0x7f15424d5990&gt;
</pre></div>
</div>
<img alt="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_30_1.png" src="../../../../_images/kepler_instrumental_noise_1_data_gaps_and_quality_flags_30_1.png" />
</div>
</div>
</section>
<section id="argabrightening">
<h3>3.2 Argabrightening<a class="headerlink" href="#argabrightening" title="Permalink to this headline">#</a></h3>
<p>Argabrightening (<a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/Data_Characteristics.pdf"><em>Kepler</em> Data Characteristics Handbook</a>, Section 5.8) is a single-cadence quality issue that looks similar to a cosmic ray on the detector. In fact, Argabrightening is thought to be caused by debris hitting the instrument, causing a brief increase in flux. This is distinct from the electronic event caused by a cosmic ray corrupting the pixel readout: Argabrightening is the result of physical illumination.</p>
<p>Using Lightkurve’s <a class="reference external" href="https://docs.lightkurve.org/api/lightkurve.utils.KeplerQualityFlags.html?highlight=decode#lightkurve.utils.KeplerQualityFlags.decode"><code class="docutils literal notranslate"><span class="pre">KeplerQualityFlags.decode()</span></code></a> function in <a class="reference external" href="#1.1-Quality-flags">Section 1.1</a>, we saw that a quality flag of 4160 indicates an Argabrightening event on the charge-coupled device (CCD) and in the optimal aperture used for photometry. Let’s see where that shows up in our data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">value</span><span class="p">[(</span><span class="n">tpf</span><span class="o">.</span><span class="n">quality</span> <span class="o">&amp;</span> <span class="mi">4160</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([191.8960099 , 226.77612309, 240.36418455, 247.80180137,
       247.82223423])
</pre></div>
</div>
</div>
</div>
<p>Argabrightening events are removed by the <em>Kepler</em> pipeline for both SAP and PDCSAP data. To see this Argabrightening event, let’s create our own light curve from the TPF, using custom aperture photometry. We can confirm that the spike in the data is right where we expect it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">235</span><span class="p">,</span><span class="mi">245</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">5250</span><span class="p">,</span><span class="mi">5600</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mf">240.1</span><span class="p">,</span> <span class="mf">240.6</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">235</span><span class="p">,</span><span class="mi">245</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">5250</span><span class="p">,</span><span class="mi">5600</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/lightkurve/targetpixelfile.py:571,</span> in <span class="ni">TargetPixelFile.to_lightcurve</span><span class="nt">(self, method, corrector, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">569</span> <span class="n">method</span> <span class="o">=</span> <span class="n">validate_method</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">supported_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;aperture&quot;</span><span class="p">,</span> <span class="s2">&quot;prf&quot;</span><span class="p">,</span> <span class="s2">&quot;sap&quot;</span><span class="p">,</span> <span class="s2">&quot;sff&quot;</span><span class="p">,</span> <span class="s2">&quot;cbv&quot;</span><span class="p">,</span> <span class="s2">&quot;pld&quot;</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">570</span> <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;aperture&quot;</span><span class="p">,</span> <span class="s2">&quot;sap&quot;</span><span class="p">]:</span>
<span class="ne">--&gt; </span><span class="mi">571</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_aperture_photometry</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">572</span> <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;prf&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">573</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prf_lightcurve</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/lightkurve/targetpixelfile.py:2172,</span> in <span class="ni">KeplerTargetPixelFile.extract_aperture_photometry</span><span class="nt">(self, aperture_mask, flux_method, centroid_method)</span>
<span class="g g-Whitespace">   </span><span class="mi">2168</span> <span class="c1"># explicitly resolve default, so that the aperture_mask set in meta</span>
<span class="g g-Whitespace">   </span><span class="mi">2169</span> <span class="c1"># later will be the resolved one</span>
<span class="g g-Whitespace">   </span><span class="mi">2170</span> <span class="n">aperture_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_default_aperture_mask</span><span class="p">(</span><span class="n">aperture_mask</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2172</span> <span class="n">flux</span><span class="p">,</span> <span class="n">flux_err</span><span class="p">,</span> <span class="n">centroid_col</span><span class="p">,</span> <span class="n">centroid_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aperture_photometry</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2173</span>     <span class="n">aperture_mask</span><span class="o">=</span><span class="n">aperture_mask</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2174</span>     <span class="n">flux_method</span><span class="o">=</span><span class="n">flux_method</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2175</span>     <span class="n">centroid_method</span><span class="o">=</span><span class="n">centroid_method</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2176</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2177</span> <span class="n">keys</span> <span class="o">=</span> <span class="p">{</span>
<span class="g g-Whitespace">   </span><span class="mi">2178</span>     <span class="s2">&quot;centroid_col&quot;</span><span class="p">:</span> <span class="n">centroid_col</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2179</span>     <span class="s2">&quot;centroid_row&quot;</span><span class="p">:</span> <span class="n">centroid_row</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2189</span>     <span class="s2">&quot;targetid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">targetid</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2190</span> <span class="p">}</span>
<span class="g g-Whitespace">   </span><span class="mi">2191</span> <span class="n">meta</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;APERTURE_MASK&quot;</span><span class="p">:</span> <span class="n">aperture_mask</span><span class="p">}</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/lightkurve/targetpixelfile.py:867,</span> in <span class="ni">TargetPixelFile._aperture_photometry</span><span class="nt">(self, aperture_mask, flux_method, centroid_method)</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>     <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Warning: aperture mask contains zero pixels.&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span> <span class="c1"># Estimate centroids</span>
<span class="ne">--&gt; </span><span class="mi">867</span> <span class="n">centroid_col</span><span class="p">,</span> <span class="n">centroid_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_centroids</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span>     <span class="n">apmask</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">centroid_method</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">871</span> <span class="c1"># Estimate flux</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span> <span class="k">if</span> <span class="n">flux_method</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/lightkurve/targetpixelfile.py:814,</span> in <span class="ni">TargetPixelFile.estimate_centroids</span><span class="nt">(self, aperture_mask, method)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> <span class="n">method</span> <span class="o">=</span> <span class="n">validate_method</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;moments&quot;</span><span class="p">,</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">813</span> <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;moments&quot;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">814</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_centroids_via_moments</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="n">aperture_mask</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">815</span> <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;quadratic&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">816</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_centroids_via_quadratic</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="n">aperture_mask</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/lightkurve/targetpixelfile.py:821,</span> in <span class="ni">TargetPixelFile._estimate_centroids_via_moments</span><span class="nt">(self, aperture_mask)</span>
<span class="g g-Whitespace">    </span><span class="mi">818</span> <span class="k">def</span> <span class="nf">_estimate_centroids_via_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aperture_mask</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">819</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Compute the &quot;center of mass&quot; of the light based on the 2D moments;</span>
<span class="g g-Whitespace">    </span><span class="mi">820</span><span class="sd">     this is a helper method for `estimate_centroids()`.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">821</span>     <span class="n">aperture_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_aperture_mask</span><span class="p">(</span><span class="n">aperture_mask</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">822</span>     <span class="n">yy</span><span class="p">,</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="g g-Whitespace">    </span><span class="mi">823</span>     <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">row</span> <span class="o">+</span> <span class="n">yy</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/lightkurve/targetpixelfile.py:659,</span> in <span class="ni">TargetPixelFile._parse_aperture_mask</span><span class="nt">(self, aperture_mask)</span>
<span class="g g-Whitespace">    </span><span class="mi">653</span>     <span class="k">elif</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">654</span>         <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">655</span>         <span class="ow">and</span> <span class="p">((</span><span class="n">aperture_mask</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">656</span>     <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">657</span>         <span class="c1"># Kepler and TESS pipeline style integer flags</span>
<span class="g g-Whitespace">    </span><span class="mi">658</span>         <span class="n">aperture_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">aperture_mask</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<span class="ne">--&gt; </span><span class="mi">659</span>     <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)):</span>
<span class="g g-Whitespace">    </span><span class="mi">660</span>         <span class="n">aperture_mask</span> <span class="o">=</span> <span class="n">aperture_mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_aperture_mask</span> <span class="o">=</span> <span class="n">aperture_mask</span>

<span class="nn">File /usr/share/miniconda/lib/python3.10/site-packages/numpy/__init__.py:284,</span> in <span class="ni">__getattr__</span><span class="nt">(attr)</span>
<span class="g g-Whitespace">    </span><span class="mi">281</span>     <span class="kn">from</span> <span class="nn">.testing</span> <span class="kn">import</span> <span class="n">Tester</span>
<span class="g g-Whitespace">    </span><span class="mi">282</span>     <span class="k">return</span> <span class="n">Tester</span>
<span class="ne">--&gt; </span><span class="mi">284</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;module </span><span class="si">{!r}</span><span class="s2"> has no attribute &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">285</span>                      <span class="s2">&quot;</span><span class="si">{!r}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

<span class="ne">AttributeError</span>: module &#39;numpy&#39; has no attribute &#39;float&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="attitude-tweaks">
<h3>3.3 Attitude tweaks<a class="headerlink" href="#attitude-tweaks" title="Permalink to this headline">#</a></h3>
<p><em>Kepler</em>’s orientation, or attitude, was adjusted every few days during Quarters 0, 1, and 2 of the nominal mission. Specifically, attitude tweaks ensured that no star would ever move more than 1/100th of a pixel from its expected location in each cadence (<a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/Data_Characteristics.pdf"><em>Kepler</em> Data Characteristics Handbook</a>, Section 4.4). From Quarter 3 onwards, changes to the telescope’s Fine Guidance Sensor (FGS) system (see the <a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/KSCI-19033-002-instrument-hb.pdf"><em>Kepler</em> Instrument Handbook</a>, particularly sections 2.1 and 2.5.1) led to reduced drift, which meant that attitude tweaks were no longer necessary.</p>
<p>Because the drift distances in <em>Kepler</em>’s first three quarters were so small, they’re hard to detect without checking the quality flags. Additionally, the discontinuities were for the most part corrected by the data processing pipeline, with only a few remaining:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;sap_flux&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">241</span><span class="p">,</span> <span class="mi">251</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">5300</span><span class="p">,</span> <span class="mi">5400</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mi">246</span><span class="p">,</span> <span class="mf">246.5</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reaction-wheel-events">
<h3>3.4 Reaction wheel events<a class="headerlink" href="#reaction-wheel-events" title="Permalink to this headline">#</a></h3>
<p><em>Kepler</em>’s attitude was controlled initially by four reaction wheels. Bits 5 and 6 are allocated to two data quality events caused by the reaction wheels: zero crossings and momentum desaturation.</p>
<p>Zero crossings (bit 5/integer 16) occur when the reaction wheels have zero angular velocity (<a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/Data_Characteristics.pdf"><em>Kepler</em> Data Characteristics Handbook</a>, Section 5.4). This caused the telescope’s point to degrade for a few minutes at a time. Because of this short timescale, reaction wheel zero crossings are mostly an issue in Short Cadence data, where they manifest as negative spikes in the flux data. Zero crossing events became less prominent after the failure of one of <em>Kepler</em>’s reaction wheels in Quarter 14, due to an increase in speed of the remaining reaction wheels. There were no reaction wheel zero crossings in the <em>K2</em> mission.</p>
<p>Momentum desaturation (bit 6/integer 32) was a consequence of a build up of torque on the reaction wheels (<a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/Data_Characteristics.pdf"><em>Kepler</em> Data Characteristics Handbook</a>, Section 5.3). Desaturation events occurred every 146 Long Cadences during the <em>Kepler</em> mission, leading to coarse pointing mode (as above) and NaN values in the light curves for one Long Cadence or several Short Cadences at a time.</p>
</section>
<section id="manual-exclusions">
<h3>3.5 Manual exclusions<a class="headerlink" href="#manual-exclusions" title="Permalink to this headline">#</a></h3>
<p>For various reasons, some cadences were manually excluded during the data processing stage. In general, these cadences were those on either side of gaps and discontinuities, but sometimes manual exclusions were used to cover specific events that didn’t fall under any other category. For example, during Quarter 12, a series of three coronal mass ejections from the Sun led to multiple cadences being manually excluded (<a class="reference external" href="https://archive.stsci.edu/kepler/release_notes/release_notes25/KSCI-19065-002DRN25.pdf"><em>Kepler</em> Data Release 25 Notes</a>, Section 12.2). Further solar flares and coronal mass ejections led to manual exclusions in Campaign 15 of <em>K2</em> (<a class="reference external" href="https://archive.stsci.edu/missions/k2/doc/drn/KSCI-19138-001_K2-DRN22_C15.pdf"><em>K2</em> Data Release 22 Notes</a>, Section 2.2). On both occasions, these incidences led to increased noise and reduced accuracy in pointing.</p>
<p>The code below plots the SAP light curve for Quarter 12 of KIC 8805616 with no quality-flagged data excluded. Here, you can clearly see the data quality issues caused by the coronal mass ejections, which are highlighted:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc_12</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_lightcurve</span><span class="p">(</span><span class="s1">&#39;KIC 8805616&#39;</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">quality_bitmask</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">lc_12</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;sap_flux&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">47200</span><span class="p">,</span><span class="mi">48200</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mf">1116.2</span><span class="p">,</span> <span class="mf">1118.7</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mf">1121.1</span><span class="p">,</span> <span class="mf">1122.3</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="mf">1160.2</span><span class="p">,</span> <span class="mf">1164.0</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="k2">
<h2>4. <em>K2</em><a class="headerlink" href="#k2" title="Permalink to this headline">#</a></h2>
<p>The <em>K2</em> mission relied on only two of <em>Kepler</em>’s reaction wheels, meaning it required an additional thruster firing every six hours to maintain pointing. This led to a six-hour drift in <em>K2</em> data; while the drift is corrected in Long Cadence data by PDC, data taken during the thruster firings is treated the same way as gaps or single-cadence quality issues in <em>Kepler</em> data. There are two quality bits allocated to thruster firings: bit 21 for a thruster firing, and bit 20 for a possible thruster firing.</p>
<p>To get an idea of what the six-hour drift looks like, let’s start by downloading some <em>K2</em> data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc_k2</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_lightcurve</span><span class="p">(</span><span class="s1">&#39;EPIC 211414081&#39;</span><span class="p">,</span> <span class="n">cadence</span><span class="o">=</span><span class="s1">&#39;long&#39;</span><span class="p">,</span> <span class="n">campaign</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">quality_bitmask</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Even with <code class="docutils literal notranslate"><span class="pre">quality_bitmask=0</span></code>, the data is gapped at all cadences flagged with bit 20 or 21. You can test this yourself by running the following code, and noting that there are no <code class="docutils literal notranslate"><span class="pre">time</span></code> values provided for any cadences with these quality flags:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">lc_k2</span><span class="o">.</span><span class="n">quality</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">lc_k2</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mi">21</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s look at the SAP light curve for this star, and see what the six-hour drift looks like in practice:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc_k2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s1">&#39;sap_flux&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Fortunately, this systematic is well-represented by the cotrending basis vectors (CBVs) used in the PDC pipeline:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lc_k2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The <a class="reference external" href="https://archive.stsci.edu/files/live/sites/mast/files/home/missions-and-data/kepler/_documents/KSCI-19116-002.pdf"><em>K2</em> Handbook</a> cautions that these effects can never be fully corrected — you can see this particularly to the left of the plot above. But overall, PDC successfully removes the six-hour drift from <em>K2</em> Long Cadence data, providing high-quality time series data for all targets.</p>
<p>In the next tutorial in this series, we’ll revisit EPIC 211414081, and look at how the thruster firings lead to persistent systematics in Short Cadence data.</p>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">#</a></h2>
<p><strong>Author:</strong> <a class="reference external" href="http://orcid.org/0000-0001-8196-516X">Isabel Colman</a> (<code class="docutils literal notranslate"><span class="pre">isabel.colman&#64;sydney.edu.au</span></code>)</p>
<p><strong>Updated on:</strong> 2020-09-29</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="citing-lightkurve-and-astropy">
<h1>Citing Lightkurve and Astropy<a class="headerlink" href="#citing-lightkurve-and-astropy" title="Permalink to this headline">#</a></h1>
<p>If you use <code class="docutils literal notranslate"><span class="pre">lightkurve</span></code> or <code class="docutils literal notranslate"><span class="pre">astropy</span></code> for published research, please cite the authors. Click the buttons below to copy BibTeX entries to your clipboard.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lk</span><span class="o">.</span><span class="n">show_citation_instructions</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "TheRealZoidberg/mast",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/MAST/Kepler/kepler_instrumental_noise_1_data_gaps_and_quality_flags"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../kepler_identifying_transiting_planet_signals/kepler_identifying_transiting_planet_signals.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Identifying Transiting Planet Signals in a <em>Kepler</em> Light Curve</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../kepler_instrumental_noise_2_spurious_signals_and_time_sampling_effects/kepler_instrumental_noise_2_spurious_signals_and_time_sampling_effects.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Instrumental Noise in <em>Kepler</em> and <em>K2</em> #2: Spurious Signals and Time Sampling Effects</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By STScI<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>