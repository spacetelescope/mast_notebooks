

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Removing Instrumental Noise from K2 and TESS Light Curves Using Pixel Level Decorrelation (PLD) &#8212; MAST Notebook Repository</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=12da95d707ffb74b382d" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=12da95d707ffb74b382d" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/table.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Beginner Notebooks" href="../../Kepler/beginner.html" />
    <link rel="prev" title="Beginner: Read and Display a K2 Full Frame Image" href="../beginner_how_to_use_ffi/beginner_how_to_use_ffi.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/mastlogo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../_static/mastlogo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Welcome to the MAST Notebook Repository!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Astrocut</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../astrocut/making_tess_cubes_and_cutouts/making_tess_cubes_and_cutouts.html">Generating Cubes and Cutouts from TESS FFIs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Astroquery</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../astroquery/intro.html">Intro</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../astroquery/nb.html">Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../astroquery/beginner_search/beginner_search.html">Beginner: Searching MAST using astroquery.mast</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../astroquery/beginner_zcut/beginner_zcut.html">Beginner: Zcut and Astroquery Tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../astroquery/large_downloads/large_downloads.html">Large Downloads in <code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code></a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">HSC</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../HSC/HCV_API/HCV_API_demo.html">Hubble Catalog of Variables Notebook (API version)</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../HSC/HSCV3_API/hscv3_api.html">Hubble Source Catalog API Notebook</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../HSC/HSCV3_SMC_API/hscv3_smc_api.html">Hubble Source Catalog API Notebook: SMC Color-Magnitude Diagram</a></li>



<li class="toctree-l1"><a class="reference internal" href="../../HSC/HSC_TAP/HSC_TAP.html">MAST Table Access Protocol Hubble Source Catalog Demo</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../HSC/SWEEPS_HSCV3P1/sweeps_hscv3p1.html">Hubble Source Catalog SWEEPS Proper Motion Notebook</a></li>






















</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">JWST</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../JWST/download_by_program_id/download_by_program_id.html">Accessing JWST Proposal Data in astroquery.mast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../JWST/Engineering_Database_Retreival/EDB_Retrieval.html">JWST Engineering Data Retrieval</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kepler K2</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../TPF/TPF.html">Beginner: Read and Display A K2 Target Pixel File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">Beginner: Read and Display a K2 Full Frame Image</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Removing Instrumental Noise from <em>K2</em> and <em>TESS</em> Light Curves Using Pixel Level Decorrelation (PLD)</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kepler</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/beginner.html">Beginner Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/plotting_lightcurves/plotting_lightcurves.html">Using Kepler Data to Plot a Light Curve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/plotting_images_from_tpf/plotting_images_from_tpf.html">Plotting Images from Kepler Target Pixel Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/plotting_dvts/plotting_dvts.html">Read and Plot A Kepler Data Validation Timeseries File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/plotting_catalog_over_FFI/plotting_catalog_over_FFI.html">Plotting a Catalog over a Kepler Full Frame Image File</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/lightkurve.html">Lightkurve</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/lightkurve_searching_for_data/lightkurve_searching_for_data.html">Searching for <em>Kepler</em>/<em>K2</em> and <em>TESS</em> Data Products Using Lightkurve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/lightkurve_custom_aperture_photometry/lightkurve_custom_aperture_photometry.html">Creating Your Own Light Curves using Custom Aperture Photometry</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/lightkurve_combining_multiple_quarters/lightkurve_combining_multiple_quarters.html">Combining Multiple Quarters of <em>Kepler</em> Data with Lightkurve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/lightkurve_interactively_inspecting_TPFs_and_LCs/lightkurve_interactively_inspecting_TPFs_and_LCs.html">Interactively Inspecting Target Pixel Files and Light Curves</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/inst_noise.html">Instrumental Noise</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/instrumental_noise_1_data_gaps_and_quality_flags/instrumental_noise_1_data_gaps_and_quality_flags.html">Data Gaps and Quality Flags</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/instrumental_noise_2_spurious_signals_and_time_sampling_effects/instrumental_noise_2_spurious_signals_and_time_sampling_effects.html">Spurious Signals and Time Sampling Effects</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/instrumental_noise_3_seasonal_and_detector_effects/instrumental_noise_3_seasonal_and_detector_effects.html">Seasonal and Detector Effects</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/instrumental_noise_4_electronic_noise/instrumental_noise_4_electronic_noise.html">Electronic Noise</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/signals.html">Identifying Periodic Signals</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/identifying_transiting_planet_signals/identifying_transiting_planet_signals.html">Identifying Transiting Planet Signals in a <em>Kepler</em> Light Curve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/measuring_a_rotation_period/measuring_a_rotation_period.html">Measuring and Removing a Rotation Period Signal from a <em>Kepler</em> Light Curve</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/visualizing_periodic_signals_using_a_river_plot/visualizing_periodic_signals_using_a_river_plot.html">Visualizing Periodic Signals Using a River Plot</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/verifying_the_location_of_a_signal/verifying_the_location_of_a_signal.html">Verifying the Location of a Signal in <em>Kepler</em> Pixel Data</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Kepler/periodograms.html">Periodograms &amp; Asteroseismology</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Kepler/creating_periodograms/creating_periodograms.html">Creating Periodograms</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star/how_to_understand_and_manipulate_the_periodogram_of_an_oscillating_star.html">How to Understand and Manipulate the Periodogram of an Oscillating Star</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../Kepler/how_to_estimate_a_stars_mass_and_radius_using_asteroseismology/how_to_estimate_a_stars_mass_and_radius_using_asteroseismology.html">How to Estimate a Star’s Mass and Radius Using Asteroseismology</a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">PanSTARRS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../PanSTARRS/PS1_DR2_TAP/PS1_DR2_TAP.html">MAST Table Access Protocol PanSTARRS 1 DR2 Demo</a></li>


</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">TESS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../TESS/beginner.html">Beginner Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_astroquery_dv/beginner_astroquery_dv.html">Retrieve TESS Data Validation Products with Astroquery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_how_to_use_dvt/beginner_how_to_use_dvt.html">Read and Plot A TESS Data Validation Timeseries File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_how_to_use_ffi/beginner_how_to_use_ffi.html">Read and Display a TESS Full Frame Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_how_to_use_lc/beginner_how_to_use_lc.html">Read and Plot A TESS Light Curve File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_how_to_use_tp/beginner_how_to_use_tp.html">Read and Display A TESS Target Pixel File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_tess_exomast/beginner_tess_exomast.html">Exoplanet Data and TESS Light Curves Using Python Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_tess_tap_search/beginner_tess_tap_search.html">Download MAST TESS Light Curves Within an FFI Footprint Using TAP</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_tic_search_hd209458/beginner_tic_search_hd209458.html">Search The TESS Input Catalog Centered On HD 209458.</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_tour_lc_tp/beginner_tour_lc_tp.html">A Tour of the Contents of the TESS 2-minute Cadence Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/beginner_tesscut_astroquery/beginner_tesscut_astroquery.html">Cutout of the TESS FFIs using Astrocut and Astroquery</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../TESS/lc.html">Light Curves</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/interm_gi_query/interm_gi_query.html">Intermediate:  Search and Download GI Program Light Curves</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../TESS/FFIs.html">TESS FFIs</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/interm_tesscut_dss_overlay/interm_tesscut_dss_overlay.html">Intermediate: Overlay a Cutout of the TESS FFIs with DSS imaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/interm_tesscut_requests/interm_tesscut_requests.html">Intermediate: Create TESS FFI Cutout using Python Requests</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../TESS/noise.html">Instrumental Noise</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/interm_tess_prf_retrieve/interm_tess_prf_retrieve.html">Intermediate: Retrieve TESS Pixel Response Function Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TESS/removing_scattered_light_using_regression/removing_scattered_light_using_regression.html">Removing Scattered Light from <em>TESS</em> Data Using the Lightkurve <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code></a></li>

</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/spacetelescope/mast_notebooks/main?urlpath=tree/notebooks/notebooks/K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/spacetelescope/mast_notebooks/blob/main/notebooks/notebooks/K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/mast_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/mast_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/K2/removing_instrumental_noise_using_pld/removing_instrumental_noise_using_pld.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Removing Instrumental Noise from K2 and TESS Light Curves Using Pixel Level Decorrelation (PLD)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Removing Instrumental Noise from <em>K2</em> and <em>TESS</em> Light Curves Using Pixel Level Decorrelation (PLD)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-pld-to-a-k2-light-curve">1. Applying PLD to a <em>K2</em> Light Curve</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnosing-the-success-of-the-correction">2. Diagnosing the Success of the Correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-avoid-overfitting-exoplanet-transits">3. How to Avoid Overfitting Exoplanet Transits</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overfitting">3.1 Overfitting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-pld-to-a-tess-light-curve">4. Applying PLD to a <em>TESS</em> Light Curve</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tuning-pldcorrector-using-optional-parameters">5. Tuning <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> Using Optional Parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definitions-of-all-additional-parameters">5.1 Definitions of all additional parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequently-asked-questions">6. Frequently Asked Questions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#citing-lightkurve-and-astropy">Citing Lightkurve and Astropy</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="removing-instrumental-noise-from-k2-and-tess-light-curves-using-pixel-level-decorrelation-pld">
<h1>Removing Instrumental Noise from <em>K2</em> and <em>TESS</em> Light Curves Using Pixel Level Decorrelation (PLD)<a class="headerlink" href="#removing-instrumental-noise-from-k2-and-tess-light-curves-using-pixel-level-decorrelation-pld" title="Permalink to this heading">#</a></h1>
<hr class="docutils" />
<section id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this heading">#</a></h2>
<p>By the end of this tutorial, you will:</p>
<ul class="simple">
<li><p>Understand how to apply the <a class="reference external" href="https://docs.lightkurve.org">Lightkurve</a> <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> tool to remove instrumental noise from <em>K2</em> and <em>TESS</em> light curves.</p></li>
<li><p>Be able to create an exoplanet transit mask and use it to improve PLD.</p></li>
<li><p>Be aware of common issues, caveats, and potential biases associated with the use of PLD.</p></li>
</ul>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>The <a class="reference external" href="https://archive.stsci.edu/k2"><em>K2</em></a> and <a class="reference external" href="https://archive.stsci.edu/tess"><em>TESS</em></a> missions both provide high-precision photometry for thousands of exoplanet candidates. However, observations by both telescopes can be muddled by instrumental systematic trends, making exoplanet detection or stellar characterization difficult.</p>
<p>Pixel Level Decorrelation (PLD) is a method that has primarily been used to remove systematic trends introduced by small spacecraft motions during observations, and has been shown to be successful at improving the precision of data taken by the <em>Spitzer</em> space telescope (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2015ApJ...805..132D/abstract">Deming et al. 2015</a>) and the <em>K2</em> mission (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2016AJ....152..100L/abstract">Luger et al. 2016</a>; <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2018AJ....156...99L/abstract">2018</a>). PLD works by identifying a set of trends in the pixels surrounding the target star, and performing linear regression to create a combination of these trends that effectively models the systematic noise introduced by spacecraft motion. This noise model is then subtracted from the uncorrected light curve.</p>
<p>This method has been shown to be very effective at removing the periodic systematic trends in <em>K2</em>, and can also help remove the scattered light background signal in <em>TESS</em> observations. This tutorial will demonstrate how to use the <a class="reference external" href="https://docs.lightkurve.org">Lightkurve</a> <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> for each mission, and will give advice on how to best implement PLD. The <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> is a special case of the <a class="reference external" href="https://docs.lightkurve.org">Lightkurve</a> <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>. For more information on how to use <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> to choose custom regressors and remove scattered light from <em>TESS</em>, please see the tutorial specifically on removing scattered light from <em>TESS</em> data using the Lightkurve <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>.</p>
<p>Before reading this tutorial, it is recommended to first familiarize yourself with using target pixel file (TPF) products and light curve products with Lightkurve.</p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<p>We only need to import the <strong><a class="reference external" href="https://docs.lightkurve.org">Lightkurve</a></strong> package for this tutorial, which in turn uses <strong><a class="reference external" href="https://matplotlib.org/">Matplotlib</a></strong> for plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<hr class="docutils" />
<section id="applying-pld-to-a-k2-light-curve">
<h2>1. Applying PLD to a <em>K2</em> Light Curve<a class="headerlink" href="#applying-pld-to-a-k2-light-curve" title="Permalink to this heading">#</a></h2>
<p>The dominant source of noise in <em>K2</em> data is created by the motion of the <em>Kepler</em> spacecraft due to periodic thruster firings. This causes stars to drift across different pixels on the detector, which have varied sensitivity. There are two classes of sensitivity variation on a charge-couped device (CCD) detector — variation between pixels (inter-pixel) and variation within each pixel (intra-pixel). Both inter- and intra-pixel sensitivity variations are present on the <em>Kepler</em> detector, which ultimately causes different flux levels to be detected as the target’s Point Spread Function (PSF) drifts across the variations, introducing the systematic trends.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> uses information from nearby pixels to create a noise model, so we need to use the <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code> data product (for more information, see the tutorial on using <em>Kepler</em> target pixel file products). We can use the <code class="docutils literal notranslate"><span class="pre">search_targetpixelfile</span></code> method to identify available observations for the desired target, and the <code class="docutils literal notranslate"><span class="pre">download</span></code> method to access the data.</p>
<p>In what follows below, we will demonstrate PLD on the exoplanet system K2-199, which was observed during <em>K2</em> Campaign 6. We can download the pixel data as follows:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_targetpixelfile</span><span class="p">(</span><span class="s1">&#39;K2-199&#39;</span><span class="p">,</span> <span class="n">mission</span><span class="o">=</span><span class="s1">&#39;K2&#39;</span><span class="p">,</span> <span class="n">campaign</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/349a06109cb73d733d97d37b7f762adf4da1ff081f96a79e43f30a14d3b4968f.png" src="../../../_images/349a06109cb73d733d97d37b7f762adf4da1ff081f96a79e43f30a14d3b4968f.png" />
</div>
</div>
<p>There are two ways to create a <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> object. The first is to create an instance of the class directly and pass in the <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">PLDCorrector</span><span class="p">(</span><span class="n">tpf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pld</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PLDCorrector (ID: EPIC 212779596)
</pre></div>
</div>
</div>
</div>
<p>For convenience, you can also use the <code class="docutils literal notranslate"><span class="pre">to_corrector</span></code> method of the <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code> object, and pass in the string <code class="docutils literal notranslate"><span class="pre">'pld'</span></code> to specify the desired corrector type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_corrector</span><span class="p">(</span><span class="s1">&#39;pld&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pld</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PLDCorrector (ID: EPIC 212779596)
</pre></div>
</div>
</div>
</div>
<p>Both of these approaches return an identical <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> object. From here, getting a corrected light curve is possible: call the <code class="docutils literal notranslate"><span class="pre">correct</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">pld</span><span class="o">.</span><span class="n">correct</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can compare the output of PLD to an uncorrected light curve. To create the uncorrected light curve, we can use the <code class="docutils literal notranslate"><span class="pre">to_lightcurve</span></code> method of the <code class="docutils literal notranslate"><span class="pre">KeplerTargetPixelFile</span></code> object, which performs simple aperture photometry (SAP) to create a light curve from the pixel data.</p>
<p>Below, the uncorrected light curve is shown in red and the PLD-corrected light curve is plotted in black.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create and plot an uncorrected light curve using Simple Aperture Photometry</span>
<span class="n">uncorrected_lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Uncorrected Light Curve&#39;</span><span class="p">);</span>
<span class="c1"># Plot the PLD-corrected light curve in black on top</span>
<span class="n">corrected_lc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PLD-corrected Light Curve&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7993100876d9c5c2d912c9ef34daeca61610d90441ba8f52d6c78bb445b5364b.png" src="../../../_images/7993100876d9c5c2d912c9ef34daeca61610d90441ba8f52d6c78bb445b5364b.png" />
</div>
</div>
<p>The uncorrected light curve is dominated by a short period (about six hours) sawtooth-shaped pattern caused by the <em>Kepler</em> spacecraft thruster firings. PLD captures this trend in the noise model and has subtracted it, leaving the much more accurate light curve in black.</p>
<p>We can quantify the improvement by comparing the Combined Differential Photometric Precision (CDPP) values for each light curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncorrected_cdpp</span> <span class="o">=</span> <span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">estimate_cdpp</span><span class="p">()</span>
<span class="n">corrected_cdpp</span> <span class="o">=</span> <span class="n">corrected_lc</span><span class="o">.</span><span class="n">estimate_cdpp</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uncorrected CDPP = </span><span class="si">{</span><span class="n">uncorrected_cdpp</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corrected CDPP = </span><span class="si">{</span><span class="n">corrected_cdpp</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Uncorrected CDPP = 2928 ppm
Corrected CDPP = 106 ppm
</pre></div>
</div>
</div>
</div>
<p>By this metric, the photometric precision improved by more than a factor of 25 after applying PLD.</p>
<p>Another important trait of PLD is that long-term variability trends in the light curve are preserved. In this example, we can see the stellar rotation of K2-199 as the sinusoidal signal left in the light curve after correction. This is done by fitting a polynomial spline model to the light curve while simultaneously fitting the noise model, because the uncorrected observation is a combination of the signals.</p>
</section>
<section id="diagnosing-the-success-of-the-correction">
<h2>2. Diagnosing the Success of the Correction<a class="headerlink" href="#diagnosing-the-success-of-the-correction" title="Permalink to this heading">#</a></h2>
<p>The success of PLD depends on a number of factors including the brightness of the object, the choice of pixels used to create the light curve and the noise model, and whether or not there exists a correlation between the instrumental noise and the astrophysical signals. For these reasons, it is important to carefully review the correct operation of the algorithm each time you use it, and tune the optional parameters of the algorithm if necessary.</p>
<p>The most convenient way to diagnose the performance of PLD is to use the <code class="docutils literal notranslate"><span class="pre">diagnose()</span></code> method, which generates a set of diagnostic plots which we will explain below the graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/2b9c8c288a045710c51ef1b08519da2b8047ec39e2342cce3aad92dd8ef30874.png" src="../../../_images/2b9c8c288a045710c51ef1b08519da2b8047ec39e2342cce3aad92dd8ef30874.png" />
</div>
</div>
<p>The diagnostic plot is composed of the following panels:</p>
<ul class="simple">
<li><p><strong>Top panel</strong>: The uncorrected light curve (<code class="docutils literal notranslate"><span class="pre">original</span></code>) is shown in black, with the Combined Differential Photometric Precision (CDPP), a measurement of the light curve’s scatter, noted in the legend.</p></li>
<li><p><strong>Middle panel</strong>: The PLD-corrected light curve (<code class="docutils literal notranslate"><span class="pre">corrected</span></code>) is plotted in gray with the noise model created by the combination of pixel values (<code class="docutils literal notranslate"><span class="pre">pixel_series</span></code>) in blue, the estimated background trend (<code class="docutils literal notranslate"><span class="pre">background</span></code>) in red, and the polynomial spline fit to the stellar variability (<code class="docutils literal notranslate"><span class="pre">spline</span></code>) in yellow. For <em>K2</em>, the background signal is minimal compared to the systematic trends due to motion, but it is much more significant for <em>TESS</em> observations. Notice that the corrected light curve closely matches the spline, which is tracing the preserved stellar variability.</p></li>
<li><p><strong>Bottom panel</strong>: A direct comparison between the uncorrected light curve (<code class="docutils literal notranslate"><span class="pre">original</span></code>) and the PLD-corrected light curve (<code class="docutils literal notranslate"><span class="pre">corrected</span></code>), again noting the CDPP of each light curve in the legend. This panel also indicates which cadences were flagged as outliers (<code class="docutils literal notranslate"><span class="pre">outlier_mask</span></code>), which lie greater than five standard deviations above or below the light curve, as well as which cadences are excluded from the spline fit (<code class="docutils literal notranslate"><span class="pre">~cadence_mask</span></code>). As we will see below, <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code> is a Boolean array with the same length as the <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code>’s time array, where <code class="docutils literal notranslate"><span class="pre">True</span></code> is included in the spline fit and <code class="docutils literal notranslate"><span class="pre">False</span></code> is excluded. The tilde (<code class="docutils literal notranslate"><span class="pre">~</span></code>) indicates that the inverse of the mask is marked in this plot, that is, the excluded cadences will be crossed out in blue.</p></li>
</ul>
<p>The plot above makes it convenient to review the components of the noise removal algorithm. The performance of the algorithm is strongly affected by the choice of pixels which go into the model components. To diagnose this part of the algorithm, we can use the <code class="docutils literal notranslate"><span class="pre">diagnose_masks</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span><span class="o">.</span><span class="n">diagnose_masks</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/7861e8af6c4579d1ee181438fafc0a69fda00c8b9f9d1e9fdf3ded5e926efce3.png" src="../../../_images/7861e8af6c4579d1ee181438fafc0a69fda00c8b9f9d1e9fdf3ded5e926efce3.png" />
</div>
</div>
<p>The panels in the figure visualize the following pixel masks:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aperture_mask</span></code>: Pixels used to create the SAP flux light curve from which the noise model is subtracted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code>: Pixels used to create the correlated noise model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code>: Pixels used to create the background model.</p></li>
</ul>
<p>You can alter the <code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code> and <code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code> by passing them as optional arguments to the <code class="docutils literal notranslate"><span class="pre">correct()</span></code> method we used earlier. For more information about these masks, and how to use them effectively, please see the full list of optional parameters and FAQ at the end of this tutorial.</p>
</section>
<section id="how-to-avoid-overfitting-exoplanet-transits">
<h2>3. How to Avoid Overfitting Exoplanet Transits<a class="headerlink" href="#how-to-avoid-overfitting-exoplanet-transits" title="Permalink to this heading">#</a></h2>
<p>In the example above, it looks like PLD did a great job of removing the instrumental noise introduced by the <em>K2</em> detector drift, but the bottom panel of the diagnostic plot seems to indicate that we’ve falsely labeled in-transit data points as outliers. To alleviate this, we can introduce the <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code>.</p>
<section id="overfitting">
<h3>3.1 Overfitting<a class="headerlink" href="#overfitting" title="Permalink to this heading">#</a></h3>
<p>It’s necessary to mask out transits and flares when fitting the spline. The spline term fits a polynomial to the long-term trend of the light curve, and the highest likelihood solution generally follows the median of the corrected light curve. The presence of transits or flares can pull the median of the light curve down or up, respectively, causing the spline to deviate from the underlying stellar trend.</p>
<p>In practice, this causes transits to be partially “fit out” by the spline, reducing their depth and giving an incorrect estimate of the planet’s radius.</p>
<p>You can use a custom <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code> by creating a Boolean array with one value per cadence, where <code class="docutils literal notranslate"><span class="pre">True</span></code> indicates a cadence you wish to include and <code class="docutils literal notranslate"><span class="pre">False</span></code> means that the cadence is masked out.</p>
<p>For this example, we want to be sure that the in-transit cadences are not marked as outliers or used in the spline fit, as they can cause the spline to erroneously deviate from the stellar signal. To accomplish this, we can create a transit mask using the <code class="docutils literal notranslate"><span class="pre">create_transit_mask</span></code> method of the <code class="docutils literal notranslate"><span class="pre">LightCurve</span></code> object, using the known parameters of the planet system:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transit_mask</span> <span class="o">=</span> <span class="n">corrected_lc</span><span class="o">.</span><span class="n">create_transit_mask</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="p">[</span><span class="mf">3.2277</span><span class="p">,</span> <span class="mf">7.3745</span><span class="p">],</span>
                                                <span class="n">duration</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> 
                                                <span class="n">transit_time</span><span class="o">=</span><span class="p">[</span><span class="mf">2385.6635</span><span class="p">,</span> <span class="mf">2389.9635</span><span class="p">])</span> 
</pre></div>
</div>
</div>
</div>
<p>We can double-check to make sure the transit mask looks good by plotting it on top of the corrected light curve in red:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">corrected_lc</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Corrected Light Curve&#39;</span><span class="p">)</span>
<span class="n">corrected_lc</span><span class="p">[</span><span class="n">transit_mask</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;transit_mask&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/53d697d4f8720e94689987161266a1f82128f3a117995c050a0162e1008d2558.png" src="../../../_images/53d697d4f8720e94689987161266a1f82128f3a117995c050a0162e1008d2558.png" />
</div>
</div>
<p>The red points appear to match the in-transit cadences for both of the planets around K2-199.</p>
<p>An additional option for the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> is the ability to remove the long-term trend. This is ideal for planet candidates, which can be more difficult to detect in the presence of stellar variability. Here, we can set the <code class="docutils literal notranslate"><span class="pre">restore_trend</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code> in order to return a light curve with the long-period trend removed.</p>
<p>Now, we can call the <code class="docutils literal notranslate"><span class="pre">correct</span></code> method of the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> again, this time passing in our <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">pld</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">cadence_mask</span><span class="o">=~</span><span class="n">transit_mask</span><span class="p">,</span> <span class="n">restore_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pld</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/8ce567166ddfe838ce54bf8a4f34ae1c3db8e936a4adcb0ddcc8a56b3eb58b8a.png" src="../../../_images/8ce567166ddfe838ce54bf8a4f34ae1c3db8e936a4adcb0ddcc8a56b3eb58b8a.png" />
</div>
</div>
<p>Now, only points that are greater than five standard deviations above or below the light curve but not in-transit will be marked as outliers, and the in-transit points (marked in blue in the bottom panel) will not be used to fit the spline.</p>
<p>If we examine the light curve and its cadence mask again, we will see that the long-period trend has been removed, and the transits are clearly visible by eye.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">corrected_lc</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Corrected Light Curve&#39;</span><span class="p">)</span>
<span class="n">corrected_lc</span><span class="p">[</span><span class="n">transit_mask</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;transit_mask&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/6c4aa4add1d68d65a2a117e42495a2eb916fc96dc40216c632b8f833c36f4206.png" src="../../../_images/6c4aa4add1d68d65a2a117e42495a2eb916fc96dc40216c632b8f833c36f4206.png" />
</div>
</div>
<p>This correction looks great! We have demonstrated that PLD is effective at removing systematic trends in <em>K2</em> data. Now, let’s apply PLD to <em>TESS</em> observations.</p>
</section>
</section>
<section id="applying-pld-to-a-tess-light-curve">
<h2>4. Applying PLD to a <em>TESS</em> Light Curve<a class="headerlink" href="#applying-pld-to-a-tess-light-curve" title="Permalink to this heading">#</a></h2>
<p><em>TESS</em> has multiple observing modes. For example, there are two-minute cadence observations, which were retrieved for specific targeted objects, and there are 30-minute cadence Full Frame Images (FFIs), which capture the entire <em>TESS</em> field of view.</p>
<p>In this example, we will examine a target using the FFI observation. The <em>TESS</em> FFIs are dominated by the scattered light background signal on the <em>TESS</em> detector, which creates high-amplitude, periodic variation. This background can make planet detection difficult, but it can be removed using PLD.</p>
<p>To access FFI data, we will use the <a class="reference external" href="https://mast.stsci.edu/tesscut/">TESScut</a> tool on the Mikulski Archive for Space Telescopes (MAST), developed by <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019ascl.soft05007B/abstract">Brasseur et al. 2019</a>. Lightkurve has a built-in search method for creating cutouts called <code class="docutils literal notranslate"><span class="pre">search_tesscut</span></code>, which uses the same syntax as the <code class="docutils literal notranslate"><span class="pre">search_targetpixelfile</span></code> method above. We will search for the Wolf-Rayet star WR 40, which was observed by <em>TESS</em> in Sector 10.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_result</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_tesscut</span><span class="p">(</span><span class="s1">&#39;WR40&#39;</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">search_result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">SearchResult containing 1 data products.

<table id="table140287604130624">
<thead><tr><th>#</th><th>mission</th><th>year</th><th>author</th><th>exptime</th><th>target_name</th><th>distance</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th>s</th><th></th><th>arcsec</th></tr></thead>
<tr><td>0</td><td>TESS Sector 10</td><td>2019</td><td><a href='https://mast.stsci.edu/tesscut/'>TESScut</a></td><td>1426</td><td>WR40</td><td>0.0</td></tr>
</table></div></div>
</div>
<p>We can download the pixel data with the <code class="docutils literal notranslate"><span class="pre">download</span></code> method. When using TESScut, this method takes the additional parameter <code class="docutils literal notranslate"><span class="pre">cutout_size</span></code>, which determines how many pixels each side length of the cutout target pixel file should have.</p>
<p>Here, we use seven pixels on each side, which strikes a good balance between downloading enough pixels to create a good background model, and not downloading too many pixels, which can result in the corrector running slowly or including neighboring stars in the noise model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span> <span class="o">=</span> <span class="n">search_result</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">cutout_size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/3a7e9828bd3850caa073b6ed9858bc7d5898e78e699e0be88b1e54f912688d7d.png" src="../../../_images/3a7e9828bd3850caa073b6ed9858bc7d5898e78e699e0be88b1e54f912688d7d.png" />
</div>
</div>
<p>We can create an uncorrected SAP light curve from this target pixel file using a threshold mask.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncorrected_lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="s1">&#39;threshold&#39;</span><span class="p">)</span>
<span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/5eceab215144c84d5229cad26a8c88c4c89e812a7e703849b8a6bd4b8ec77261.png" src="../../../_images/5eceab215144c84d5229cad26a8c88c4c89e812a7e703849b8a6bd4b8ec77261.png" />
</div>
</div>
<p>The dominant trend in the SAP light curve above is the dramatic ramp up in flux due to the scattered light background on the <em>TESS</em> detector. The pulsation signal of WR 40 can also be seen clearly, with some additional long-period variability.</p>
<p>We will create a <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> object, and use the default values for <code class="docutils literal notranslate"><span class="pre">PLDCorrector.correct</span></code> to remove this scattered light background.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">PLDCorrector</span><span class="p">(</span><span class="n">tpf</span><span class="p">)</span>
<span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">pld</span><span class="o">.</span><span class="n">correct</span><span class="p">()</span>
<span class="n">pld</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/79d98620f44f767c0b35d40b284eda64b9aa07465ca2c0405e408372ee97921f.png" src="../../../_images/79d98620f44f767c0b35d40b284eda64b9aa07465ca2c0405e408372ee97921f.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">background</span></code> component of the PLD model (shown in blue in the middle panel) has successfully isolated the large spikes without fitting out the pulsations of WR 40.</p>
<p>We can also examine the apertures used to perform this correction. For <em>TESS</em>, the dominant source of noise is the scattered light background, so by default only those pixels will be used. In the third panel, we can see that the <code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code> contains only background pixels, reducing the risk of contamination by neighboring stars.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span><span class="o">.</span><span class="n">diagnose_masks</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/8c961fb626913dfc1f1a4e7be3ee6ae572470bebd72bb3ba7cff77fc39629235.png" src="../../../_images/8c961fb626913dfc1f1a4e7be3ee6ae572470bebd72bb3ba7cff77fc39629235.png" />
</div>
</div>
</section>
<section id="tuning-pldcorrector-using-optional-parameters">
<h2>5. Tuning <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> Using Optional Parameters<a class="headerlink" href="#tuning-pldcorrector-using-optional-parameters" title="Permalink to this heading">#</a></h2>
<p>In this section, we explore the optional parameters available when using the PLD method.</p>
<p>These keywords can be used to influence the performance of PLD. The PLD design matrix is constructed from three distinct submatrices, shown below with their corresponding keywords:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">background_model</span></code></strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code></p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">pixel_series</span></code></strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pld_order</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pca_components</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code></p></li>
</ul>
</li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">spline</span></code></strong></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">spline_n_knots</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">spline_degree</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">restore_trend</span></code></p></li>
</ul>
</li>
</ul>
<section id="definitions-of-all-additional-parameters">
<h3>5.1 Definitions of all additional parameters<a class="headerlink" href="#definitions-of-all-additional-parameters" title="Permalink to this heading">#</a></h3>
<p>Full descriptions of each of these keywords can be found below.</p>
<p><strong><code class="docutils literal notranslate"><span class="pre">pld_order</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>):</p>
<ul class="simple">
<li><p>The order of Pixel Level Decorrelation to be performed. First order (<code class="docutils literal notranslate"><span class="pre">n=1</span></code>) uses only the pixel fluxes to construct the design matrix. Higher order populates the design matrix with columns constructed from the products of pixel fluxes. Default 3 for <em>K2</em> and 1 for <em>TESS</em>.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">pca_components</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code> or tuple of <code class="docutils literal notranslate"><span class="pre">int</span></code>):</p>
<ul class="simple">
<li><p>Number of terms added to the design matrix for each order of PLD
pixel fluxes. Increasing this value may provide higher precision
at the expense of slower speed and/or overfitting. If performing PLD with <code class="docutils literal notranslate"><span class="pre">pld_order</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">pca_components</span></code> can be a tuple containing the number of terms for each order of PLD. If a single <code class="docutils literal notranslate"><span class="pre">int</span></code> is passed, the same number of terms will be used for each order.  If zero is passed, Principle Component Analysis (PCA) will not be performed.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">array-like</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code>):</p>
<ul class="simple">
<li><p>A Boolean array flagging the background pixels such that <code class="docutils literal notranslate"><span class="pre">True</span></code> means
that the pixel will be used to generate the background systematics model.
If <code class="docutils literal notranslate"><span class="pre">None</span></code>, all pixels which are fainter than 1-sigma above the median flux will be used.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">array-like</span></code>, <code class="docutils literal notranslate"><span class="pre">'pipeline'</span></code>, <code class="docutils literal notranslate"><span class="pre">'all'</span></code>, <code class="docutils literal notranslate"><span class="pre">'threshold'</span></code>, or <code class="docutils literal notranslate"><span class="pre">None</span></code>):</p>
<ul class="simple">
<li><p>A Boolean array describing the aperture such that <code class="docutils literal notranslate"><span class="pre">True</span></code> means
that the pixel will be used when selecting the PLD basis vectors. If <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">all</span></code> are passed in, all pixels will be used. If <code class="docutils literal notranslate"><span class="pre">'pipeline'</span></code> is passed, the mask suggested by the official pipeline will be returned. If <code class="docutils literal notranslate"><span class="pre">'threshold'</span></code> is passed, all pixels brighter than 3-sigma above the median flux will be used.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">spline_n_knots</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>):</p>
<ul class="simple">
<li><p>Number of knots in spline.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">spline_degree</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>)</p>
<ul class="simple">
<li><p>Polynomial degree of spline.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">restore_trend</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>):</p>
<ul class="simple">
<li><p>Whether to restore the long-term spline trend to the light curve.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">sparse</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>):</p>
<ul class="simple">
<li><p>Whether to create <code class="docutils literal notranslate"><span class="pre">SparseDesignMatrix</span></code>.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> of <code class="docutils literal notranslate"><span class="pre">bool</span></code>)</p>
<ul class="simple">
<li><p>(optional) Mask, where <code class="docutils literal notranslate"><span class="pre">True</span></code> indicates a cadence that should be used.</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">sigma</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>):</p>
<ul class="simple">
<li><p>Standard deviation at which to remove outliers from fitting (default 5).</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">niters</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>)</p>
<ul class="simple">
<li><p>Number of iterations to fit and remove outliers (default 5).</p></li>
</ul>
<p><strong><code class="docutils literal notranslate"><span class="pre">propagate_errors</span></code></strong> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>):</p>
<ul class="simple">
<li><p>Whether to propagate the uncertainties from the regression. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>. Setting to <code class="docutils literal notranslate"><span class="pre">True</span></code> will increase run time, but will sample from multivariate normal distribution of weights.</p></li>
</ul>
</section>
</section>
<section id="frequently-asked-questions">
<h2>6. Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this heading">#</a></h2>
<p><strong>How should I select the pixels to use?</strong></p>
<p>As shown earlier, there are three aperture masks used in the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aperture_mask</span></code>: Used to create the SAP flux light curve from which the noise model is subtracted. For this aperture, you should select as many pixels as possible that only contain flux from the target star. This is done automatically using a threshold mask, but it is a good idea to examine that mask with the <code class="docutils literal notranslate"><span class="pre">diagnose_masks</span></code> method to ensure it does not include background targets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code>: Pixels used to create the background model. These pixels should not contain flux from the target star whose light curve you are attempting to correct, nor should it contain flux from background targets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code>: Pixels used to create the correlated noise model. This aperture mask is more difficult to define, and may change on a case-by-case basis. For <em>K2</em>, this mask should contain as many pixels as possible in order to best capture the persistent motion-generated noise. For <em>TESS</em>, this mask should have less of an impact than the background mask, but should include all pixels in the cutout that do not contain background stars.</p></li>
</ul>
<p><strong>How can I speed up the correction?</strong></p>
<p>The spline <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> used in <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> can be substituted for a <code class="docutils literal notranslate"><span class="pre">SparseDesignMatrix</span></code>. These behave identically to traditional <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> objects, but use <code class="docutils literal notranslate"><span class="pre">scipy.sparse</span></code> to speed up calculation and reduce memory. This can be done by passing in <code class="docutils literal notranslate"><span class="pre">sparse=True</span></code> to the <code class="docutils literal notranslate"><span class="pre">correct</span></code> method.</p>
<p><strong>What do I do if I get a singular matrix error?</strong></p>
<p>A singular matrix error occurs when a matrix used in <code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code> cannot be inverted, a step necessary for optimizing the coefficients. The primary reason this occurs is that the input <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> has low rank relative to the number of column vectors. There are two suggested solutions to this issue:</p>
<ul class="simple">
<li><p>Limit the number of input column vectors by performing Principle Component Analysis (PCA). This is done automatically in <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>, but the number of output PCA vectors can be reduced using the <code class="docutils literal notranslate"><span class="pre">pca_components</span></code> keyword in the <code class="docutils literal notranslate"><span class="pre">correct</span></code> method from its default value of 16.</p></li>
<li><p>Ensure you are not masking out too much of your data. For instance, if you are using the <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code>, make sure that the values you want to include in your detrending are labeled as <code class="docutils literal notranslate"><span class="pre">True</span></code>. Using the inverse <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code> will often raise a singular matrix error.</p></li>
</ul>
</section>
<section id="about-this-notebook">
<h2>About this Notebook<a class="headerlink" href="#about-this-notebook" title="Permalink to this heading">#</a></h2>
<p><strong>Authors</strong>: Nicholas Saunders (nksaun&#64;hawaii.edu), Geert Barentsen</p>
<p><strong>Updated</strong>: September 29, 2020</p>
</section>
</section>
<section id="citing-lightkurve-and-astropy">
<h1>Citing Lightkurve and Astropy<a class="headerlink" href="#citing-lightkurve-and-astropy" title="Permalink to this heading">#</a></h1>
<p>If you use <code class="docutils literal notranslate"><span class="pre">lightkurve</span></code> or its dependencies in your published research, please cite the authors. Click the buttons below to copy BibTeX entries to your clipboard.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lk</span><span class="o">.</span><span class="n">show_citation_instructions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

<style>
    button {
        border: 1px solid;
        padding: 0.2em;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 0.8em;
        margin: 0.2em;
        cursor: pointer;
    }

    .citation-button-1 {background-color: #4CAF50;} /* Green */
    .citation-button-2 {background-color: #008CBA;} /* Blue */
</style>

<script type="text/javascript">
    function copyBibtex(package) {
        var copyText = document.getElementById(package + "Text");
        copyText.select();
        document.execCommand("copy");
        alert("BibTex has been copied to your clipboard")
    }
</script>
</head>

<body>
    <textarea id="lightkurveText" style="position: absolute; left: -9999px; z-index: -9999;">
@MISC{2018ascl.soft12013L,
    author = {{Lightkurve Collaboration} and {Cardoso}, J.~V.~d.~M. and
                {Hedges}, C. and {Gully-Santiago}, M. and {Saunders}, N. and
                {Cody}, A.~M. and {Barclay}, T. and {Hall}, O. and
                {Sagear}, S. and {Turtelboom}, E. and {Zhang}, J. and
                {Tzanidakis}, A. and {Mighell}, K. and {Coughlin}, J. and
                {Bell}, K. and {Berta-Thompson}, Z. and {Williams}, P. and
                {Dotson}, J. and {Barentsen}, G.},
    title = "{Lightkurve: Kepler and TESS time series analysis in Python}",
    keywords = {Software, NASA},
howpublished = {Astrophysics Source Code Library},
        year = 2018,
    month = dec,
archivePrefix = "ascl",
    eprint = {1812.013},
    adsurl = {http://adsabs.harvard.edu/abs/2018ascl.soft12013L},
}
    </textarea>
    <textarea id="astropyText" style="position: absolute; left: -9999px; z-index: -9999;">
@ARTICLE{astropy:2022,
       author = {{Astropy Collaboration} and {Price-Whelan}, Adrian M. and {Lim}, Pey
       Lian and {Earl}, Nicholas and {Starkman}, Nathaniel and {Bradley}, Larry and
       {Shupe}, David L. and {Patil}, Aarya A. and {Corrales}, Lia and {Brasseur}, C.~E.
       and {N{\"o}the}, Maximilian and {Donath}, Axel and {Tollerud}, Erik and {Morris},
       Brett M. and {Ginsburg}, Adam and {Vaher}, Eero and {Weaver}, Benjamin A. and
       {Tocknell}, James and {Jamieson}, William and {van Kerkwijk}, Marten H. and
       {Robitaille}, Thomas P. and {Merry}, Bruce and {Bachetti}, Matteo and
       {G{\"u}nther}, H. Moritz and {Aldcroft}, Thomas L. and {Alvarado-Montes}, Jaime
       A. and {Archibald}, Anne M. and {B{\'o}di}, Attila and {Bapat}, Shreyas and
       {Barentsen}, Geert and {Baz{\'a}n}, Juanjo and {Biswas}, Manish and {Boquien},
       M{\'e}d{\'e}ric and {Burke}, D.~J. and {Cara}, Daria and {Cara}, Mihai and
       {Conroy}, Kyle E. and {Conseil}, Simon and {Craig}, Matthew W. and {Cross},
       Robert M. and {Cruz}, Kelle L. and {D'Eugenio}, Francesco and {Dencheva}, Nadia
       and {Devillepoix}, Hadrien A.~R. and {Dietrich}, J{\"o}rg P. and {Eigenbrot},
       Arthur Davis and {Erben}, Thomas and {Ferreira}, Leonardo and {Foreman-Mackey},
       Daniel and {Fox}, Ryan and {Freij}, Nabil and {Garg}, Suyog and {Geda}, Robel and
       {Glattly}, Lauren and {Gondhalekar}, Yash and {Gordon}, Karl D. and {Grant},
       David and {Greenfield}, Perry and {Groener}, Austen M. and {Guest}, Steve and
       {Gurovich}, Sebastian and {Handberg}, Rasmus and {Hart}, Akeem and
       {Hatfield-Dodds}, Zac and {Homeier}, Derek and {Hosseinzadeh}, Griffin and
       {Jenness}, Tim and {Jones}, Craig K. and {Joseph}, Prajwel and {Kalmbach}, J.
       Bryce and {Karamehmetoglu}, Emir and {Ka{\l}uszy{\'n}ski}, Miko{\l}aj and
       {Kelley}, Michael S.~P. and {Kern}, Nicholas and {Kerzendorf}, Wolfgang E. and
       {Koch}, Eric W. and {Kulumani}, Shankar and {Lee}, Antony and {Ly}, Chun and
       {Ma}, Zhiyuan and {MacBride}, Conor and {Maljaars}, Jakob M. and {Muna}, Demitri
       and {Murphy}, N.~A. and {Norman}, Henrik and {O'Steen}, Richard and {Oman}, Kyle
       A. and {Pacifici}, Camilla and {Pascual}, Sergio and {Pascual-Granado}, J. and
       {Patil}, Rohit R. and {Perren}, Gabriel I. and {Pickering}, Timothy E. and
       {Rastogi}, Tanuj and {Roulston}, Benjamin R. and {Ryan}, Daniel F. and {Rykoff},
       Eli S. and {Sabater}, Jose and {Sakurikar}, Parikshit and {Salgado}, Jes{\'u}s
       and {Sanghi}, Aniket and {Saunders}, Nicholas and {Savchenko}, Volodymyr and
       {Schwardt}, Ludwig and {Seifert-Eckert}, Michael and {Shih}, Albert Y. and
       {Jain}, Anany Shrey and {Shukla}, Gyanendra and {Sick}, Jonathan and {Simpson},
       Chris and {Singanamalla}, Sudheesh and {Singer}, Leo P. and {Singhal}, Jaladh and
       {Sinha}, Manodeep and {Sip{\H{o}}cz}, Brigitta M. and {Spitler}, Lee R. and
       {Stansby}, David and {Streicher}, Ole and {{\v{S}}umak}, Jani and {Swinbank},
       John D. and {Taranu}, Dan S. and {Tewary}, Nikita and {Tremblay}, Grant R. and
       {Val-Borro}, Miguel de and {Van Kooten}, Samuel J. and {Vasovi{\'c}}, Zlatan and
       {Verma}, Shresth and {de Miranda Cardoso}, Jos{\'e} Vin{\'\i}cius and {Williams},
       Peter K.~G. and {Wilson}, Tom J. and {Winkel}, Benjamin and {Wood-Vasey}, W.~M.
       and {Xue}, Rui and {Yoachim}, Peter and {Zhang}, Chen and {Zonca}, Andrea and
       {Astropy Project Contributors}}, title = "{The Astropy Project: Sustaining and
       Growing a Community-oriented Open-source Project and the Latest Major Release
       (v5.0) of the Core Package}",
      journal = {\apj},
     keywords = {Astronomy software, Open source software, Astronomy data analysis, 1855, 1866, 1858, Astrophysics - Instrumentation and Methods for Astrophysics},
         year = 2022,
        month = aug,
       volume = {935},
       number = {2},
          eid = {167},
        pages = {167},
          doi = {10.3847/1538-4357/ac7c74},
archivePrefix = {arXiv},
       eprint = {2206.14220},
 primaryClass = {astro-ph.IM},
       adsurl = {https://ui.adsabs.harvard.edu/abs/2022ApJ...935..167A},
      adsnote = {Provided by the SAO/NASA Astrophysics Data System}
}


    </textarea>
    <textarea id="astroqueryText" style="position: absolute; left: -9999px; z-index: -9999;">
@ARTICLE{2019AJ....157...98G,
   author = {{Ginsburg}, A. and {Sip{\H o}cz}, B.~M. and {Brasseur}, C.~E. and
	{Cowperthwaite}, P.~S. and {Craig}, M.~W. and {Deil}, C. and
	{Guillochon}, J. and {Guzman}, G. and {Liedtke}, S. and {Lian Lim}, P. and
	{Lockhart}, K.~E. and {Mommert}, M. and {Morris}, B.~M. and
	{Norman}, H. and {Parikh}, M. and {Persson}, M.~V. and {Robitaille}, T.~P. and
	{Segovia}, J.-C. and {Singer}, L.~P. and {Tollerud}, E.~J. and
	{de Val-Borro}, M. and {Valtchanov}, I. and {Woillez}, J. and
	{The Astroquery collaboration} and {a subset of the astropy collaboration}
	},
    title = "{astroquery: An Astronomical Web-querying Package in Python}",
  journal = {\aj},
archivePrefix = "arXiv",
   eprint = {1901.04520},
 primaryClass = "astro-ph.IM",
 keywords = {astronomical databases: miscellaneous, virtual observatory tools},
     year = 2019,
    month = mar,
   volume = 157,
      eid = {98},
    pages = {98},
      doi = {10.3847/1538-3881/aafc33},
   adsurl = {http://adsabs.harvard.edu/abs/2019AJ....157...98G},
  adsnote = {Provided by the SAO/NASA Astrophysics Data System}
}

    </textarea>
    <textarea id="tesscutText" style="position: absolute; left: -9999px; z-index: -9999;">
@MISC{2019ascl.soft05007B,
        author = {{Brasseur}, C.~E. and {Phillip}, Carlita and {Fleming}, Scott W. and
          {Mullally}, S.~E. and {White}, Richard L.},
         title = "{Astrocut: Tools for creating cutouts of TESS images}",
      keywords = {Software},
          year = 2019,
         month = may,
           eid = {ascl:1905.007},
         pages = {ascl:1905.007},
 archivePrefix = {ascl},
        eprint = {1905.007},
        adsurl = {https://ui.adsabs.harvard.edu/abs/2019ascl.soft05007B},
       adsnote = {Provided by the SAO/NASA Astrophysics Data System}
 }
    </textarea>

    <p>
        When using Lightkurve, we kindly request that you cite the following packages:
        <ul>
            <li>
                <a href="https://docs.lightkurve.org">lightkurve</a>
                <button onclick="copyBibtex('lightkurve')"><i class="fas fa-clipboard"></i> Copy BibTeX</button>
            </li>
            <li>
                <a href="https://astropy.org">astropy</a>
                <button onclick="copyBibtex('astropy')"><i class="fas fa-clipboard"></i> Copy BibTeX</button>
            </li>
            <li>
                <a href="https://astroquery.readthedocs.io">astroquery</a>
                <button onclick="copyBibtex('astroquery')"><i class="fas fa-clipboard"></i> Copy BibTeX</button>
                —  if you are using <i>search_lightcurve()</i> or <i>search_targetpixelfile()</i>.
            </li>
            <li>
                <a href="https://mast.stsci.edu/tesscut/">tesscut</a>
                <button onclick="copyBibtex('tesscut')"><i class="fas fa-clipboard"></i> Copy BibTeX</button>
                — if you are using <i>search_tesscut()</i>.
            </li>
        </ul>
    </p>
</body>
</div></div>
</div>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/K2/removing_instrumental_noise_using_pld"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../beginner_how_to_use_ffi/beginner_how_to_use_ffi.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Beginner: Read and Display a K2 Full Frame Image</p>
      </div>
    </a>
    <a class="right-next"
       href="../../Kepler/beginner.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Beginner Notebooks</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Removing Instrumental Noise from <em>K2</em> and <em>TESS</em> Light Curves Using Pixel Level Decorrelation (PLD)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-goals">Learning Goals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-pld-to-a-k2-light-curve">1. Applying PLD to a <em>K2</em> Light Curve</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#diagnosing-the-success-of-the-correction">2. Diagnosing the Success of the Correction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-avoid-overfitting-exoplanet-transits">3. How to Avoid Overfitting Exoplanet Transits</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#overfitting">3.1 Overfitting</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#applying-pld-to-a-tess-light-curve">4. Applying PLD to a <em>TESS</em> Light Curve</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tuning-pldcorrector-using-optional-parameters">5. Tuning <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> Using Optional Parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definitions-of-all-additional-parameters">5.1 Definitions of all additional parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequently-asked-questions">6. Frequently Asked Questions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#about-this-notebook">About this Notebook</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#citing-lightkurve-and-astropy">Citing Lightkurve and Astropy</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            <div class="bd-footer-content__inner">
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div></div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=12da95d707ffb74b382d"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=12da95d707ffb74b382d"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>